# Device type definitions for CAN bus devices
# Each device type has:
#   - name: Human-readable device name
#   - bus_id_extractor: How to extract device instance ID from arbitration_id
#   - matchers: List of message patterns that update device properties
#
# Property extraction templates:
#   - Bit extraction: "(byte_index,bit_index)" - extracts single bit (0 or 1)
#   - Byte extraction: "[byte_index]" - extracts full byte value (0-255)
#   - Formatter: optional format string for logging (default: '{}')
#
# Message structure for switch pairs (8 bytes):
#   Bytes 0-3: Lower switch data (S1, S3, S5)
#     - Byte 0: Brightness level (0x01 = full on, 0x00 = off, 0x02-0xFF = dimmed)
#     - Byte 3, bit 0: ON/OFF state
#   Bytes 4-7: Higher switch data (S2, S4, S6)
#     - Byte 4: Brightness level (0x01 = full on, 0x00 = off, 0x02-0xFF = dimmed)
#     - Byte 7, bit 0: ON/OFF state

bloc9:
  name: "Bloc9"
  # Extract bus ID from lowest byte: clear MSB, shift right 3
  # Formula: ((arb_id & 0xFF) & ~0x80) >> 3
  bus_id_extractor:
    type: "formula"
    formula: "((arb_id & 0xFF) & ~0x80) >> 3"
  
  matchers:
    - address: 0x00000600
      mask: 0xFFFFFF00
      name: "Status update"
      properties:
        stat1_0:
          template: "(1,0)"
        stat1_1:
          template: "(1,1)"
        stat1_2:
          template: "(1,2)"
        stat1_3:
          template: "(1,3)"
        stat1_4:
          template: "(1,4)"
        stat1_5:
          template: "(1,5)"
        stat1_6:
          template: "(1,6)"
        stat1_7:
          template: "(1,7)"
        stat2_0:
          template: "(2,0)"
        stat2_1:
          template: "(2,1)"
        stat2_2:
          template: "(2,2)"
        stat2_3:
          template: "(2,3)"
        stat2_4:
          template: "(2,4)"
        stat2_5:
          template: "(2,5)"
        stat2_6:
          template: "(2,6)"
        stat2_7:
          template: "(2,7)"
        stat3_0:
          template: "(3,0)"
        stat3_1:
          template: "(3,1)"
        stat3_2:
          template: "(3,2)"
        stat3_3:
          template: "(3,3)"
        stat3_4: 
          template: "(3,4)"
        stat3_5: 
          template: "(3,5)"
        stat3_6: 
          template: "(3,6)"
        stat3_7: 
          template: "(3,7)"
        stat4_0: 
          template: "(4,0)"
        stat4_1: 
          template: "(4,1)"
        stat4_2: 
          template: "(4,2)"
        stat4_3:      
          template: "(4,3)"
        stat4_4:      
          template: "(4,4)"
        stat4_5:      
          template: "(4,5)"
        stat4_6:      
          template: "(4,6)"
        stat4_7:      
          template: "(4,7)" 
    - address: 0x02160600
      mask: 0xFFFFFF00
      name: "S1 & S2 Status update"
      properties:
        s1:
          template: "(3,0)"
          formatter: "{}"
        s1_dim:
          template: "[0]"
          formatter: "{}"
        s2:
          template: "(7,0)"
          formatter: "{}"
        s2_dim:
          template: "[4]"
          formatter: "{}"
    
    - address: 0x02180600
      mask: 0xFFFFFF00
      name: "S3 & S4 Status update"
      properties:
        s3:
          template: "(3,0)"
          formatter: "{}"
        s3_dim:
          template: "[0]"
          formatter: "{}"
        s4:
          template: "(7,0)"
          formatter: "{}"
        s4_dim:
          template: "[4]"
          formatter: "{}"
    
    - address: 0x021A0600
      mask: 0xFFFFFF00
      name: "S5 & S6 Status update"
      properties:
        s5:
          template: "(3,0)"
          formatter: "{}"
        s5_dim:
          template: "[0]"
          formatter: "{}"
        s6:
          template: "(7,0)"
          formatter: "{}"
        s6_dim:
          template: "[4]"
          formatter: "{}"
